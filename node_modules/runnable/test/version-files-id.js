var User = require('../index'); // runnable api
var expect = require('chai').expect;

describe('build files id', function () {
  var ctx = {};
  beforeEach(function (done) {
    var user = new User();
    ctx.file = user.newContext('contextId').newVersion('versionId').newFile('/');
    done();
  });
  afterEach(function (done) {
    Object.keys(ctx).forEach(function (key) {
      delete ctx[key];
    });
    done();
  });

  it('should have an id and Key', function(done) {
    expect(ctx.file.id()).to.equal('/');
    expect(ctx.file.toJSON().Key).to.equal('/contextId/source/');
    done();
  });
  it('should set and get the id and Key', function(done) {
    ctx.file.id('/Dockerfile');
    expect(ctx.file.id()).to.equal('/Dockerfile');
    expect(ctx.file.id(ctx.file.id())).to.equal('/Dockerfile');
    expect(ctx.file.toJSON().Key).to.equal('/contextId/source/Dockerfile');
    expect(ctx.file.path()).to.equal('contexts/contextId/versions/versionId/files/Dockerfile');
    done();
  });
  it('should set and get the Key and id', function(done) {
    ctx.file.attrs.Key = 'contextId/source/Dockerfile';
    expect(ctx.file.id()).to.equal('/Dockerfile');
    done();
  });
});