doctype html
html.home(
  lang = "en"
)
  head
    meta(
      charset = "utf-8"
    )
    meta(
      content = "width=device-width, initial-scale=1"
      name = "viewport"
    )

    title Runnable

    //- css
    link(
      href = "/build/css/home.css?v=#{locals.version}"
      media = "screen"
      rel = "stylesheet"
    )

    //- favicon
    link(
      href = "/build/images/favicon.png"
      rel = "shortcut icon"
    )

    //- ios and safari icons
    link(
      href = "/build/images/icons-ios.png"
      rel = "apple-touch-icon"
    )
    meta(
      console = "Runnable"
      name = "apple-mobile-web-app-title"
    )

    if env !== 'development'
      script(type="text/javascript").
        window._trackJs = {
          token: 'ea5e26c7ec2d486e9c66bcf4fefa0f4b',
          version: "#{locals.version}",
          onError: function (payload, error) {
            payload.network.filter(function (item) {
              if (item.url.indexOf('mixpanel') !== -1) {
                return false;
              }
              return true;
            });
            return true;
          }
        };
      script(type="text/javascript" src="https://d2zah9y47r7bi2.cloudfront.net/releases/current/tracker.js")

    //- mixpanel
    if (env === 'production')
      script.
        (function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
        for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);
        mixpanel.init("57260a5b6fc972e9c69184882efd009e");

     if (env === 'staging')
      script.
        (function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
        for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);
        mixpanel.init("abed31a0844a1bf389205355edfda4c2");

    if env === 'production'
      script.
        // Intercom
        (function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',intercomSettings);}else{var d=document;var i=function(){i.c(arguments)};i.q=[];i.c=function(args){i.q.push(args)};w.Intercom=i;function l(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/wqzm3rju';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);}if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})()

    if (env === 'production')
      script.
        //Google Analytics
        (function (i, s, o, g, r, a, m) {
          i["GoogleAnalyticsObject"] = r;
          i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
          }, i[r].l = 1 * new Date();
          a = s.createElement(o),
                  m = s.getElementsByTagName(o)[0];
          a.async = 1;
          a.src = g;
          m.parentNode.insertBefore(a, m)
        })(window, document, "script", "//www.google-analytics.com/analytics.js", "ga");
        ga("create", "UA-59677301-1", "auto");
        ga("send", "pageview");

    script(
      src= "https://ajax.googleapis.com/ajax/libs/angularjs/1.3.16/angular.min.js"
    )


    script.
      var whitelisted = window.location.search !== '?whitelist=false';
      var app = angular.module('homeApp', []);
      app.controller('MainCtrl', function ($scope, $window, $http) {
        $scope.loginUrl = '#{locals.apiHost}/auth/github?redirect=' + $window.location.protocol + '//' + $window.location.host + '/?auth';
        $scope.data = {
          embedActive: false,
          hideUnauthorizedModal: whitelisted
        };

        $http.get('#{locals.apiHost}/users/me', {
          withCredentials: true
        })
          .then(function (user) {
            var org;
            try {
              org = user.data.userOptions.uiState.previousLocation.org;
            } catch (e) {
              org = user.data.accounts.github.username;
            }
            $window.location = '/' + org;
          });
      });

  body.clearfix(
    ng-app = "homeApp"
    ng-class = "{'modal-open': !data.hideUnauthorizedModal}"
    ng-controller = "MainCtrl"
  )
    //
      TIME: #{locals.commitTime}
      HASH: #{locals.commitHash}
      LINK: http://github.com/codenow/runnable-angular/commits/#{locals.commitHash}

    //- svg file
    .svg-defs
      include ../../client/templates/svg/svgDefs.jade

    //- page
    .layout-wrapper.clearfix

      //- unauthorized modal
      .modal-backdrop(
        ng-click = "data.hideUnauthorizedModal = true"
        ng-if = "!data.hideUnauthorizedModal"
      )
        .modal-dialog.home-modal-dialog(
          ng-click = "$event.stopPropagation();"
        )
          svg.iconnables.icons-close(
            ng-click = "data.hideUnauthorizedModal = true"
          )
            use(
              xlink:href = "#icons-close"
            )
          section.modal-body
            h1.h1 We’re sorry, but your GitHub account doesn’t have access to the Runnable preview.
            a.btn.green(
              href = "mailto:support@runnable.com?subject=Please send me an invite for a preview of Runnable!"
            ) Request an Invite
          footer.modal-footer.small You can&#32;
            a.link(
              href = "//github.com/settings/applications"
              target = "_blank"
            ) revoke our access
            | &#32;to your GitHub account.
            br
            | We’ll ask for it again when you’re invited.

      //- header
      header.home-header
        a.link(
          href = "mailto:support@runnable.com?subject=Please send me an invite for a preview of Runnable!"
        ) Request Invite
        a.link(
          href = "mailto:support@runnable.com"
        ) Email Us
        a.link(
          href = "http://support.runnable.io/"
          target = "_blank"
        ) Support
        a.link(
          ng-href = "{{loginUrl}}"
        ) Log In

      section.home-hero
        img.logo(
          height = "72"
          src = "/build/images/runnable-logo.svg"
          width = "360"
        )
        h1.h1.text-center Runnable lets you create Sandboxes (collections of one or more servers)
          br.br
          | &#32;to run the code in your GitHub repositories, on-demand.
        .row.clearfix
          p.p.col We integrate with the tools you’re already using, like GitHub and Slack, to automatically deploy commits and launch containers in your Sandbox when you create branches and notify you when they are updated via Slack.
          p.p.col It’s easy to share Sandboxes in a team as you develop and test your application—and you can continue to use your existing tools and processes for deployment without having to change the way you work.
        .row.clearfix
          .embed-preview(
            ng-click = "data.embedActive = true"
          )
            .preview
            a.link.text-center Watch a 3 minute overview
              svg.svg(
                xmlns = 'http://www.w3.org/2000/svg'
                viewbox = '0 0 24 24'
              )
                path.path(
                  d = 'M9.7,17.5L9.7,17.5c-0.4,0-0.7-0.3-0.7-0.8l0-9.4C9,7,9.1,6.8,9.2,6.7c0.3-0.3,0.7-0.3,1,0l6.4,4.6c0.3,0.2,0.4,0.5,0.4,0.8c0,0.3-0.1,0.6-0.4,0.7l-6.4,4.5C10.1,17.4,9.9,17.5,9.7,17.5z M10,7.7l0,8.5l6-4.2L10,7.7z'
                )
                path.path(
                  d = 'M12,1c6.1,0,11,4.9,11,11s-4.9,11-11,11S1,18.1,1,12S5.9,1,12,1 M12,0C5.4,0,0,5.4,0,12s5.4,12,12,12s12-5.4,12-12S18.6,0,12,0L12,0z'
                )
          .row-request Want preview access?
            a.btn.btn-lg.purple(
              href = "mailto:support@runnable.com?subject=Please send me an invite for a preview of Runnable!"
            ) Request Access

          .row-codesnippets.text-center Are you looking for &#32;
            a.link(
              href = "//code.runnable.com"
            ) Runnable CodeSnippets
            | ?
        //- START video
        .modal-backdrop.in(
          ng-if = "data.embedActive"
        )
          .embed-video
            button.btn.btn-sm(
              ng-click = "data.embedActive = false"
            )
              svg.iconnables.icons-close.float-left
                use(
                  xlink:href = "#icons-close"
                )
              | Close

            iframe.iframe(
              allowfullscreen
              frameborder = "0"
              height = "720"
              src = "https://www.youtube.com/embed/Zlm9E_Miar8?rel=0&amp;showinfo=0;autoplay=1"
              width = "1280"
            )
        //- END video