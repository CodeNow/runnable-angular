header.modal-header
  //- title
  .container-title-wrapper.title-verification
    .server-status-card-pop-over.no-touching
      span.text-overflow.container-title {{SMC.state.repo.attrs.name}}
      button.btn.btn-xxs.gray(
        ng-if = "$root.featureFlags.nameContainer"
        pop-over
        pop-over-options = "{\"left\":0,\"top\":0}"
        pop-over-template = "viewPopoverRenameContainer"
      ) Rename

  svg.iconnables.icons-close(
    ng-if = "$root.featureFlags.rebuildFlow"
  )
    use(
      xlink:href = "#icons-close"
    )

  //- tabs
  .row.modal-tabs.js-animate(
    ng-if="$root.featureFlags.newVerificationFlow"
    ng-class = "{\
      'tabs-1': SMC.state.step === 1,\
      'tabs-2': SMC.state.step === 2,\
      'tabs-7': SMC.state.step === 3 && !$root.featureFlags.whitelist,\
      'tabs-8': SMC.state.step === 3 && $root.featureFlags.whitelist,\
      'tabs-all': SMC.state.step ===  4\
    }"
    style = "{{SMC.state.step > 1 ? 'transition-duration: .3s' : ''}}"
  )
    button.btn.btn-radio(
      ng-class = "{'active': SMC.selectedTab === 'repository'}"
      ng-click = "SMC.changeTab('repository');"
      ng-if = "(SMC.state.step >= 1 && !SMC.state.advanced)"
    )
      svg.iconnables
        use(
          xlink:href = "#icons-repository"
        )
      .btn-text Repository
    button.btn.btn-radio.js-animate(
      ng-class = "{'active': SMC.selectedTab === 'commands'}"
      ng-click = "SMC.changeTab('commands')"
      ng-if = "(SMC.state.step >= 2 && !SMC.state.advanced)"
    )
      svg.iconnables
        use(
          xlink:href = "#icons-packages"
        )
      .btn-text Commands
        br
        | & Packages
    button.btn.btn-radio(
      ng-class = "{'active': SMC.selectedTab === 'whitelist'}"
      ng-click = "SMC.changeTab('whitelist')"
      ng-if = "(SMC.state.step >= 3 && $root.featureFlags.whitelist)"
    )
      svg.iconnables
        use(
          xlink:href = "#icons-ip-whitelist"
        )
      .btn-text Security
    button.btn.btn-radio.js-animate(
      ng-class = "{'active': SMC.selectedTab === 'ports'}"
      ng-click = "SMC.changeTab('ports')"
      ng-if = "(SMC.state.step >= 3 && !SMC.state.advanced)"
    )
      svg.iconnables
        use(
          xlink:href = "#icons-ports"
        )
      .btn-text Exposed Ports
    button.btn.btn-radio.js-animate(
      ng-class = "{'active': SMC.selectedTab === 'env'}"
      ng-click = "SMC.changeTab('env')"
      ng-if = "SMC.state.step >= 3"
    )
      svg.iconnables
        use(
          xlink:href = "#icons-environment-variable"
        )
      .btn-text Environment Variables
    button.btn.btn-radio.js-animate(
      ng-class = "{'active': SMC.selectedTab === 'files'}"
      ng-click = "SMC.changeTab('files')"
      ng-if = "SMC.state.step >= 3 && !SMC.state.advanced"
    )
      svg.iconnables
        use(
          xlink:href = "#icons-keys-files"
        )
      .btn-text Files & SSH Keys
    button.btn.btn-radio.js-animate(
      ng-class = "{'active': SMC.selectedTab === 'translation'}"
      ng-click = "SMC.changeTab('translation')"
      ng-if = "SMC.state.step >= 3"
    )
      svg.iconnables
        use(
          xlink:href = "#icons-translation"
        )
      .btn-text Find & Replace
    button.btn.btn-radio.js-animate(
      ng-class = "{'active': SMC.selectedTab === 'buildfiles'}"
      ng-click = "SMC.changeTab('buildfiles')"
      ng-if = "SMC.state.step >= 3"
    )
      svg.iconnables
        use(
          xlink:href = "#icons-dockerfile"
        )
      .btn-text Dockerfile
    button.btn.btn-radio.js-animate(
      data-badge-count = "!"
      ng-class = "{\
        'active': SMC.selectedTab === 'logs',\
        'badge': !$root.isLoading.setupServerModal && SMC.instance && SMC.isDirty()\
      }"
      ng-click = "SMC.changeTab('logs')"
      ng-if = "SMC.state.step >= 4"
    )
      svg.iconnables
        use(
          xlink:href = "#icons-log"
        )
      .btn-text Logs

section.modal-body(
  ng-if = "$root.isLoading.setupServerModal"
)
  .spinner-wrapper.spinner-md.in(
    ng-include = "'spinner'"
  )

section.modal-body(
  ng-if = "!$root.isLoading.setupServerModal"
)
  .modal-form(
    ng-class = "{'empty': SMC.state.step === 3 && SMC.selectedTab === null}"
  )
    //- Stack & Branch
    .label(
      is-new-container = "true"
      loading-promises-target = "setupServerModal"
      ng-if = "!$root.featureFlags.newVerificationFlow || SMC.selectedTab === 'repository'"
      stack-selector-form
      state = "SMC.state"
    )
    //- Commands
    .label(
      loading-promises-target = "setupServerModal"
      ng-if = "!$root.featureFlags.newVerificationFlow || SMC.selectedTab === 'commands'"
      repository-form
      start-command-can-disable = "true"
      state = "SMC.state"
    )
    //- Default messages
    h3.h3.empty.text-center(
      ng-if = "SMC.state.step === 3 && SMC.selectedTab === null"
    ) Your container is ready to build!
    small.small.empty.text-center(
      ng-if = "SMC.state.step === 3 && SMC.selectedTab === null"
    ) You can use the tools above to make additional changes to your configuration.
    //- Ports
    .modal-form(
      ng-show = "SMC.selectedTab === 'ports'"
      ports = "SMC.state.ports"
      ports-form
    )
    //- Environment variables
    .modal-form(
      ng-include = "'viewFormEnvironmentVariables'"
      ng-show = "SMC.selectedTab === 'env'"
    )
    //- Files & SSH Keys
    .modal-form(
      ng-controller = "ContainerFilesController as CFC"
      ng-include = "'viewFormFiles'"
      ng-init = "CFC.init({state: SMC.state, getDisplayName: SMC.getDisplayName})"
      ng-show = "SMC.selectedTab === 'files'"
    )
    //- Find & Replace
    .modal-form(
      ng-show = "SMC.selectedTab === 'translation'"
      instance = "SMC.instance"
      state = "SMC.state"
      data = "SMC.data"
      translation-rules
    )
    //- Dockerfile
    .modal-form(
      ng-include = "'viewFormBuildfiles'"
      ng-show = "SMC.selectedTab === 'buildfiles'"
    )
    //- Logs
    .modal-form.modal-logs(
      ng-class = "{\
        'ace-runnable-dark': !$root.featureFlags.imAfraidOfTheDark,\
        'ace-runnable-light': $root.featureFlags.imAfraidOfTheDark\
      }"
      ng-include = "'viewFormLogs'"
      ng-show = "SMC.selectedTab === 'logs'"
    )
    .modal-form.form-whitelist(
      ng-if = "$root.featureFlags.whitelist"
      ng-include = "'whitelistForm'"
      ng-show = "SMC.selectedTab === 'whitelist'"
    )

footer.modal-footer.clearfix

  //- **********
    - new things
    - **********
  button.btn.btn-md.white.btn-cancel.float-left.js-animate(
    ng-click = "SMC.actions.close()"
    ng-if = "$root.featureFlags.rebuildFlow && SMC.state.step < 4"
    type = "button"
  ) Cancel

  button.btn.btn-md.btn-done.white.float-right.js-animate(
    ng-click = "SMC.actions.close()"
    ng-if = "$root.featureFlags.rebuildFlow && SMC.state.step > 3"
    type = "button"
  ) Done

  //- next, next, save & build button`
    - classes change depending on text for width:
      .text-save-build
      .text-save
      .text-next
  button.btn.btn-md.btn-primary.white.float-right(
    ng-class = "{\
      'text-next': SMC.state.step < 3,\
      'text-save-build': SMC.state.step === 3\
    }"
    ng-click = "SMC.goToNextStep()"
    ng-disabled = "\
      SMC.setupServerForm.$invalid ||\
      (SMC.state.selectedStack | selectedStackInvalid)\
    "
    ng-if = "$root.featureFlags.rebuildFlow"
    setup-confirm-button
    type = "button"
  )
    //- text should read "Next" for steps 1, 2
    //- changes to "Save & Build" starting from step 3 (or save)
    span.btn-text.float-left {{buttonText}}

    //- arrow is visible for steps 1-3
    svg.iconnables.icons-arrow-forward.float-right(
      ng-if = "SMC.state.step < 3"
    )
      use(
        xlink:href = "#icons-arrow-down"
      )

  //- **********
    - old things
    - **********
  button.btn.btn-md.white.float-left(
    ng-click = "SMC.actions.close()"
    ng-if = "!$root.featureFlags.rebuildFlow"
    type = "button"
  ) Cancel

  //- next, next, start build, create container button (old)
  button.btn.btn-md.btn-spinner.float-right(
    ng-class = "{\
      'white': !buttonClosesModal,\
      'green': buttonClosesModal,\
      'in': $root.isLoading.setupServerModalIsBuilding\
    }"
    ng-click = "SMC.goToNextStep()"
    ng-disabled = "\
      SMC.setupServerForm.$invalid ||\
      (SMC.state.selectedStack | selectedStackInvalid)\
    "
    ng-if = "$root.featureFlags.newVerificationFlow && !$root.featureFlags.rebuildFlow"
    setup-confirm-button
    style = "{{!$root.featureFlags.rebuildFlow ? 'width: auto;' : ''}}"
  )
    //- spinner
    .spinner-wrapper.spinner-sm.in(
      ng-class = "{\
        'spinner-gray': !buttonClosesModal,\
        'spinner-white': buttonClosesModal\
      }"
      ng-if = "$root.isLoading.setupServerModalIsBuilding"
      ng-include = "'spinner'"
    )
    //- text should read "Next" for steps 1, 2
    //- changes to "Save & Build" starting from step 3
    span.btn-text {{buttonText}}

  //- start build button (old/pre-verification-flow)
  button.btn-md.btn.green.float-right(
    ng-click = "SMC.createServerAndClose()"
    ng-disabled = "\
      SMC.setupServerForm.$invalid ||\
      (SMC.state.selectedStack | selectedStackInvalid)\
    "
    ng-if = "!$root.featureFlags.newVerificationFlow"
  ) Start Build
