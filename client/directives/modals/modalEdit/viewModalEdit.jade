.modal-dialog.modal-edit
  header.modal-header
    label.input-group.input-validate.with-description(
      ng-form
      name = "renameForm"
      ng-class = "{\
          focus: renameForm.showFocus,\
          'ng-invalid': renameForm.$invalid,\
          'ng-valid': renameForm.$valid\
        }"
    )
      span.input-label
        svg.iconnables.icons-edit
          use(
          xlink:href = "#icons-edit"
          )
        | Edit
      span.input-description.text-overflow {{ data.newName }}-{{ data.instance.attrs.owner.username }}.runnableapp.com
      input.input(
      autofocus
      instance = "data.instance"
      name = "name"
      ng-blur = "renameForm.showFocus = false"
      ng-focus = "renameForm.showFocus = true"
      ng-model = "state.newName"
      ng-init = "renameForm.$setPristine(); \
          renameForm.showFocus = true;"
      placeholder = "My-Server"
      spellcheck = "false"
      validate-name = "data.instances"
      validate-name-pattern
      value = "{{ data.instance.attrs.name }}"
      )
    //- .invalid-pattern for names with invalid characters
      - .invalid-name for names that are taken
    .validate-wrapper.btn-sm.orange(
    ng-class = "{\
        'invalid-pattern': renameForm.$error.namePattern.length,\
        'invalid-name': renameForm.$error.nameAvailable.length,\
        'invalid-require': renameForm.$error.nameRequire.length\
      }"
    )
      span.validate-rules.invalid-pattern Please use #{''}
        b.btn-xs.orange A-Z
        b.btn-xs.orange a-z
        b.btn-xs.orange 0-9
        b.btn-xs.orange _
        b.btn-xs.orange -
      span.validate-rules.invalid-name That's a pretty name, but it's taken
      span.validate-rules.invalid-require Give your server an alphanumeric name
  .modal-body
    //- sidebar
    section.sidebar.server-sidebar
      section.row.repo-list(
        build = "build"
        show-add-repo = "true"
        repo-list
      )
      section.row.explorer(
        explorer
        title = "Build Files"
        file-model = "build.contextVersions.models[0]"
        root-dir = "build.contextVersions.models[0].rootDir"
        open-items = "openItems"
        show-repo-folder = "true"
      )
      section.row.explorer
        //- no files or folders can be added to this file-tree
        //- these files cannot be renamed or deleted
        ul.file-tree
         li.file
           a(
             ng-click = "openItems.addBuildStream()"
           )
             svg.iconnables.filetypes.icons-logs
               use(
                 xlink:href = "#icons-logs"
               )
             span.item-name build logs
         li.file
           a(
             ng-click = "openItems.addEnvVars()"
           )
             svg.iconnables.filetypes.icons-file
               use(
                 xlink:href = "#icons-file"
               )
             span.item-name environment variables
             //- must appear before .btn-file-action in the DOM
             span.btn-file-errors.orange(
               ng-if = "data.instance.validation.envs.errors.length"
             ) {{ data.instance.validation.envs.errors.length }}
             //- can we make sure opening this popover also opens and focuses the env file?
             button.btn-xxs.btn-file-action(
               ng-class = "{active: popoverLinkServers.data.show}"
               toggle-pop-over
               toggle-pop-over-model = "popoverLinkServers.data.show"
               ng-click = "$event.stopPropagation()"
             )
               svg.iconnables.icons-link
                 use(
                   xlink:href = "#icons-link"
                 )
               pop-over(
                 actions = "popoverLinkServers.actions"
                 data = "popoverLinkServers.data"
                 popover-options = "{\"left\":-270,\"top\":-107}"
                 template = "viewPopoverLinkServers"
               )
    //- editor
    section.views.with-add-tab(
      active-panel
      ng-class = "{ \
        in: (data.showExplorer && \
             !data.loading) \
        }"
      open-items = "openItems"
      build = "data.instance.build"
      instance = "data.instance"
      use-auto-update = "true"
    )
  footer.modal-footer
    //- ng-disabled = "!validation.valid"
    button.btn.green(
      ng-click = "actions.buildServer()"
      type = "button"
    ) Build Server
       //- spinner
      .spinner-wrapper.spinner-sm.spinner-white.in(
        ng-if = "building"
        ng-include = "'spinner'"
      )
    button.btn.white(
      ng-click = "actions.close()"
      type = "button"
    ) Go Back
    span.btn-file-errors.orange(
      ng-if = "getAllErrorsCount()"
    ) {{ getAllErrorsCount() }} errors