form.modal-dialog.modal-integrations(
  name = "slackForm"
  ng-class = "{'unverified': !data.verified}"
)

  header.modal-header
    h1.modal-heading
      img.img(
        height = "24"
        src = "/build/images/logos/logo-icon-slack.svg"
        width = "24"
      )
      | Slack Integration

  .alert.orange(
    ng-if = "!data.settings.attrs.notifications.slack.enabled && data.verified"
  ) Slack integration has been disabled
    button.btn.btn-xxs.white(
      ng-click = "data.settings.attrs.notifications.slack.enabled = true"
    ) Enable

  section.modal-body

    .spinner-wrapper.spinner-md.in(
      ng-if = "data.loading"
      ng-include = "'spinner'"
    )

    .modal-form(
      ng-if = "!data.loading"
    )

      label.label.clearfix

        .label-col Bot API Token

        .input-col
          input.input.input-sm.monospace(
            ng-model = "data.settings.attrs.notifications.slack.apiToken"
            ng-readonly = "data.verified"
            required
            spellcheck = "false"
          )
          small.small(
            ng-if = "!data.verified"
          ) Get container status updates in Slack. You can use the API token from an existing bot, or #{''}

            a.link(
              href = "https://slack.com/services/new/bot"
              ng-if = "!data.verified"
              target = "_blank"
            ) create a new bot to obtain an API token
            | .
          button.btn.btn-xs.white.float-right(
            ng-click = "data.verified = !data.verified"
            ng-if = "data.verified"
            type = "button"
          ) Change Token

      .label(
        ng-if = "data.verified"
      )
        .clearfix
          .label-col Messaging

        .list.list-bordered(
          ng-if = "data.verified"
        )
          label.list-item.label-checkbox.text-overflow(
            ng-class = "{\
              active: member.slackOn,\
              disabled: !data.settings.attrs.notifications.slack.enabled,\
              expanded: !member.found && member.slackOn\
            }"
            ng-repeat = "member in data.slackMembers"
          )
            .badge-warning(
              ng-if = "\
                !member.found && \
                member.slackOn && \
                !member.ghName && data.settings.attrs.notifications.slack.enabled\
              "
            )
              svg.iconnables.icons-warning
                use(
                  xlink:href = "#icons-warning"
                )
            img.gravatar(
              height = "21"
              ng-src = "{{ member.profile.image_24 }}"
              width = "21"
            )
            | @{{ member.name }}
            label.toggle-wrapper.float-right
              input.toggle-input(
                ng-disabled = "!data.settings.attrs.notifications.slack.enabled"
                ng-model = "member.slackOn"
                type = "checkbox"
              )
              .toggle-group.toggle-sm(
                ng-class = "{invalid: !member.found && member.slackOn && !member.ghName}"
              )
            .well.small(
              ng-class = "{'no-touching': !data.settings.attrs.notifications.slack.enabled}"
              ng-click = "$event.preventDefault();"
              ng-if = "!member.found && member.slackOn"
            ) We couldn't match this Slack user to a Github username. #{''}
              br.br
              | Select their username to enable messaging.
              select.select(
                ng-if = "!member.found"
                ng-model = "member.ghName"
                ng-options = "ghMember for ghMember in data.ghMembers"
              )
                option(
                  disabled
                  selected = "selected"
                  value = ""
                ) Select Github username
        small.small(
          ng-if = "data.verified"
        ) Members will receive messages from your bot when their containers are updated.

      //- disabling integration:
        - removes all .active class on labels
        - disables all inputs, but preserves their states
      .label.label-footer(
        ng-if = "data.verified"
      )
        button.btn.btn-xs.orange(
          ng-click = "data.settings.attrs.notifications.slack.enabled = false"
          ng-if = "data.settings.attrs.notifications.slack.enabled"
        ) Disable Slack Integration
        button.btn.btn-xs.green(
          ng-click = "data.settings.attrs.notifications.slack.enabled = true"
          ng-if = "!data.settings.attrs.notifications.slack.enabled"
        ) Enable Slack Integration
        small.small No messages will be sent while integration is disabled,
          br.br
          | but your API Token and user settings will be preserved.

  footer.modal-footer
    //- before API token verified
    button.btn.green.btn-spinner(
      ng-class = "{in: data.verifying}"
      ng-click = "actions.verifySlack()"
      ng-disabled = "\
        data.verifying || \
        !data.settings.attrs.notifications.slack.apiToken.length\
      "
      ng-if = "!data.verified"
    )
      .spinner-wrapper.spinner-sm.spinner-white.in(
        ng-include = "'spinner'"
        ng-show = "data.verifying"
      )
      | Verify API Token

    //- if API token has been verified
    button.btn.green(
      ng-click = "defaultActions.close(actions.saveSlack)"
      ng-if = "data.verified"
    ) Save

    button.btn.white.btn-cancel(
      ng-click = "defaultActions.close()"
    ) Cancel
