header.box-header

  runnable-instance-edit-box-name

  runnable-instance-edit-primary-actions(
    saving = "dataInstanceEdit.data.saving"
    open-items = "dataInstanceEdit.data.openItems"
  )

  runnable-instance-edit-secondary-actions(
    saving = "dataInstanceEdit.data.saving"
  )

  //-
    h1.box-info
      .box-name {{ dataInstanceEdit.data.instance.attrs.name }}
        svg.iconnables.icons-edit
          use(
            xlink:href = "#icons-edit"
          )
      input.box-url(
        readonly
        select-all
        value = "{{ dataInstanceEdit.data.instance.attrs.name }}.{{ dataInstanceEdit.data.instance.attrs.owner.username }}.runnable.io"
      )
      //- sets layout on h1.box-name for .box-url
      span.box-name-ghost {{ dataInstanceEdit.data.instance.attrs.name }}.username.runnable.io

    .primary-actions
      button.orange(
        ng-click = "dataInstanceEdit.actions.build()"
        type = "button"
      ) Build

    .secondary-actions
      .save-spinner(
        ng-class = "{ in: dataInstanceEdit.data.saving }"
      )
      a.btn.white.btn-icon.btn-actions(
        ng-class = "{active: dataInstanceEdit.data.popoverGearMenu.data.show}"
        toggle-pop-over
        toggle-pop-over-model = "dataInstanceEdit.data.popoverGearMenu.data.show"
        type = "button"
      )
        svg.iconnables.icons-gear
          use(
            xlink:href = "#icons-gear"
          )
        //- popover for rename, for, delete box
        pop-over(
          actions = "dataInstanceEdit.data.popoverGearMenu.actions"
          data = "dataInstanceEdit.data.popoverGearMenu.data"
          template = "viewInstanceEditPopoverActions"
        )
      button.white(
        ng-click = "dataInstanceEdit.actions.goToInstance(true)"
        type = "button"
      ) Discard Changes

//- sidebar with repositories and urls
section.sidebar.box-sidebar

  runnable-repo-list

  runnable-docker-validation(
    open-items = "dataInstanceEdit.data.openItems"
  )
  //-
    section.row(
      ng-if = "dataInstanceEdit.data.envValidation.errors"
    )
      .sidebar-validation
        h2.sub-header Environmental Var Errors
        ul.list-group
          li.list-group-item(
            ng-repeat = "errorLine in dataInstanceEdit.data.envValidation.errors"
          ) Invalid line {{ errorLine + 1 }}

section.views.with-add-tab(
  ng-class = "{ \
    in: (dataInstanceEdit.data.showExplorer && \
         !dataInstanceEdit.data.loading) \
  }"
)

  //- explorer
  button.btn-sm.white.btn-icon.explorer-toggle(
    ng-click = "dataInstanceEdit.data.showExplorer = !dataInstanceEdit.data.showExplorer"
    type = "button"
  )
    svg.iconnables.icons-folder-open
      use(
        xlink:href = "#icons-folder-open"
      )

  runnable-explorer(
    open-items = "dataSetup.data.openItems"
    toggle-theme = "dataSetup.data.toggleTheme"
  )
  //-
    section.explorer
      .explorer-controls
        button.toggle-theme(
          ng-class = "{dark: !dataInstanceEdit.data.toggleTheme, light: dataInstanceEdit.data.toggleTheme}"
          ng-click = "dataInstanceEdit.data.toggleTheme = !dataInstanceEdit.data.toggleTheme"
          ng-init = "dataInstanceEdit.data.toggleTheme = true"
          tooltip = "Change Theme"
          tooltip-options = "{\"class\":\"bottom\",\"left\":11,\"top\":36}"
        )
          .theme
      file-tree(
        open-items = "dataInstanceEdit.data.openItems"
        read-only = "false"
        root-dir = "dataInstanceEdit.data.version.rootDir"
      )

  //- tabs
  tabs(
    open-items = "dataInstanceEdit.data.openItems"
  )

  runnable-add-tab(
    open-items = "dataInstanceEdit.data.openItems"
  )
  //-
    a.btn.btn-sm.white.btn-icon.add-tab(
      ng-class = "{active: dataInstanceEdit.data.popoverAddTab.data.show}"
      toggle-pop-over
      toggle-pop-over-model = "dataInstanceEdit.data.popoverAddTab.data.show"
    )
      svg.iconnables.icons-add
        use(
          xlink:href = "#icons-add"
        )
      pop-over(
        actions = "dataInstanceEdit.data.popoverAddTab.actions"
        data = "dataInstanceEdit.data.popoverAddTab.data"
        template = "popoverAddTab"
      )

  //- active panel
  //- Passing in old build to access it's logs
  active-panel(
    instance = "dataInstanceEdit.data.instance"
    container = "dataInstanceEdit.data.container"
    build = "dataInstanceEdit.data.instance.build"
    is-dark-theme = "dataInstanceEdit.data.toggleTheme"
    open-items = "dataInstanceEdit.data.openItems"
    update = "true"
  )

  //- blank state
  .blank-panel(
    ng-if= "dataInstanceEdit.data.openItems.activeHistory.models.length === 0"
  )
    ul.blank-panel-group
      li.blank-panel-item(
        ng-click = "dataInstanceEdit.data.openItems.addBuildStream()"
      )
        svg.iconnables.iconnables-lg.icons-logs
          use(xlink:href = "#icons-logs")
        | Build Log
      li.blank-panel-item(
        ng-click = "dataInstanceEdit.data.openItems.addEnvVars().envVarsReadOnly = false;"
      )
        svg.iconnables.iconnables-lg.icons-env-vars
          use(xlink:href = "#icons-env-vars")
        | Env Vars
