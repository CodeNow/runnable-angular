section.row.repo-list
  h2.sub-header Repositories
    //- update / build button
    a.btn.btn-xs.orange.sub-header-action(
      ng-click = "triggerInstanceUpdateOnRepoCommitChange()"
      ng-if = "showUpdateButton"
      tooltip = "Update your box to see your changes"
      tooltip-options = "{\"class\":\"bottom\",\"top\":24}"
    ) Update
      svg.iconnables.icons-update
        use(
          xlink:href = "#icons-update"
        )

    //- add repo button
    a.btn.btn-sm.white.sub-header-action.btn-add-repo(
      ng-class = "{active: data.show}"
      ng-if = "edit"
      toggle-pop-over
      toggle-pop-over-model = "data.show"
      type = "button"
    )
      svg.iconnables.icons-add
        use(
          xlink:href = "#icons-add"
        )
      pop-over(
        actions = "actions"
        data = "data"
        template = "viewPopoverAddRepo"
      )

  //- show .guide if /new && no repositories have been added yet
  .guide.blue(
    ng-if = "showGuide && data.version.appCodeVersions.models.length === 0"
    toggle-pop-over
    toggle-pop-over-model = "data.show"
  )
    svg.iconnables.icons-git
      use(
        xlink:href = "#icons-git"
      )
    p Add a repository to your box.

  ul.repository-group
    li.repository-group-item(
      ng-repeat = "acv in build.contextVersions.models[0].appCodeVersions.models"
    )
      svg.iconnables.icons-git
        use(
          xlink:href = "#icons-git"
        )
      h3.repository-title {{ acv.attrs.repo }}

      //- if not editing and behind latest
      button.btn-xs.white.repository-update(
        ng-click = "selectLatestCommit(acv)"
        ng-if = "!edit && acv.githubRepo.state.activeBranch.state.activeCommit.state.commitsBehind"
        tooltip = "Fast-forward {{ acv.githubRepo.state.activeBranch.attrs.name }} \
                   ({{ acv.githubRepo.state.activeBranch.state.activeCommit.state.commitsBehind ? \
                     acv.githubRepo.state.activeBranch.state.activeCommit.state.commitsBehind +' commits behind' : \
                     'To latest' }})"
        tooltip-options = "{\"class\":\"bottom\",\"top\":24}"
      ) {{ acv.githubRepo.state.activeBranch.state.activeCommit.state.commitsBehind }}
        svg.iconnables.icons-update
          use(
            xlink:href = "#icons-update"
          )

      //- if editing
      button.btn-xs.white.repository-actions(
        ng-class = "{ active: state.repoData.show }"
        toggle-pop-over
        toggle-pop-over-model = "state.repoData.show"
        type = "button"
        ng-if = "edit"
      )
        svg.iconnables.icons-gear
          use(
            xlink:href = "#icons-gear"
          )
        pop-over(
          actions = "data.popoverRepoActions.actions"
          data = "state.repoData"
          template = "viewInstanceEditPopoverRepoActions"
        )

      //- add .pending for orange
      .commit.load(
        ng-class = "{ \
          pending: acv.githubRepo.state.activeBranch.state.activeCommit && (acv.attrs.commit !== acv.githubRepo.state.activeBranch.state.activeCommit.attrs.sha) \
        }"
        ng-click = " \
          acv.state.toggleFilter = false; \
          acv.state.commitFilter = ''; \
          acv.githubRepo.state.selectedBranch = acv.githubRepo.state.activeBranch; \
          actions.fetchBranchesForRepo(acv.githubRepo); \
          actions.fetchCommitsForBranch(acv, githubRepo.state.activeBranch); \
        "
        toggle-pop-over
        toggle-pop-over-model = "acv.state.show"
      )
        .commit-message {{ acv.githubRepo.state.activeBranch.state.activeCommit.attrs.commit.message }}
        svg.iconnables.icons-commit
          use(
            xlink:href = "#icons-commit"
          )
        span.commit-author {{ acv.githubRepo.state.activeBranch.state.activeCommit.attrs.author.login }}
        time.commit-time {{ acv.githubRepo.state.activeBranch.state.activeCommit.attrs.commit.author.date | timeAgo }}
      pop-over(
        actions = "actions"
        data = "acv"
        template = "viewInstancePopoverCommitSelect"
      )
