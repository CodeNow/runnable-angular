nav.sub-header
  h1.build-header.divided-header.animations-off(
    ng-class = "{in: !dataBuild.data.build.attrs.started }"
  )
    button.btn-icon.silver.tooltip(
      data-title = "View All Builds"
      ng-click = "dataBuild.actions.stateToBuildList()"
      type = "button"
    )
      svg.iconnables.icons-back-table
        use(xlink:href = "#icons-back-table")
    .iconnables.iconnables-container
      svg.iconnables.icons-check
        use(xlink:href = "#icons-check")
      svg.iconnables.icons-asterisk
        use(xlink:href = "#icons-asterisk")
    | Build {{ dataBuild.data.build.attrs.buildNumber || (dataBuild.data.build.attrs.id | limitTo:4)+'...' }}

  //- all buttons should be disabled during a build
  section#main-controls(ng-class = "{in: !dataBuild.data.build.attrs.started}")
    .clean(ng-class = "{in: dataBuild.data.build.attrs.started}")
      //- on failed builds, run instance needs to be disabled
      button.orange(
        ng-click = "dataBuild.actions.runInstance()"
        ng-disabled = "dataBuild.data.build.failed()"
        type = "button"
      ) Run Instance
      .btn-group
        button.silver(
          ng-click = "dataBuild.actions.rebuild()"
          ng-disabled = "!dataBuild.data.build.attrs.completed"
          type = "button"
        ) Rebuild
        a.btn.silver.btn-icon(
          ng-class = "{active: !dataBuild.data.showCleanRebuildMenu}"
          toggle-pop-over
          toggle-pop-over-model = "dataBuild.data.showCleanRebuildMenu"
        )
          svg.iconnables.icons-arrow-down
            use(xlink:href = "#icons-arrow-down")
          pop-over(
            actions = "{ \
              getPopoverButtonText: dataBuild.actions.getPopoverButtonText, \
              resetInputModelValue: dataBuild.actions.resetInputModelValue \
            }"
            data = "{ \
              buildName: dataBuild.data.buildName, \
              show: dataBuild.data.showCleanRebuildMenu \
            }"
            template = "viewBuildPopoverBuildOptions"
          )
    .dirty(ng-class = "{in: !dataBuild.data.build.attrs.started}")
      .btn-group
        button.green(
          type = "button"
          ng-click = "dataBuild.actions.build()"
        ) Build
        a.btn.green.btn-icon(
          ng-class = "{active: databuild.data.showDirtyBuildMenu }"
          toggle-pop-over
          toggle-pop-over-model = "dataBuild.data.showDirtyBuildMenu"
        )
          svg.iconnables.icons-arrow-down
            use(xlink:href = "#icons-arrow-down")
          pop-over(
            actions = "{ \
              getPopoverButtonText: dataBuild.actions.getPopoverButtonText, \
              resetInputModelValue: dataBuild.actions.resetInputModelValue \
            }"
            data = "{ \
              buildName: dataBuild.data.buildName, \
              show: dataBuild.data.showDirtyBuildMenu \
            }"
            template = "viewBuildPopoverBuildOptions"
          )
      button.silver(
        ng-click = "dataBuild.actions.discardChanges()"
        type = "button"
      ) Discard Changes

section.sidebar
  ul(ng-show = "dataBuild.data.build.attrs.created")
    li
      svg.iconnables.icons-recipe
        use(xlink:href = "#icons-recipe")
      b {{ dataApp.stateParams.branchName }}
      | #{''} config
    li(ng-show = "!dataBuild.data.build.failed()")
      svg.iconnables.icons-duration
        use(xlink:href = "#icons-duration")
      | Built in {{ (dataBuild.data.build.buildTime() / 1000) | number:2 }} seconds
    li(
      interval-update
      interval-update-ms = "60000"
      ng-show = "dataBuild.data.build.attrs.started"
    )
      svg.iconnables.icons-calendar
        use(xlink:href = "#icons-calendar")
      | Initiated {{ dataBuild.data.build.attrs.created | timeAgo }}
    li
      svg.iconnables.icons-trigger
        use(xlink:href = "#icons-trigger")
      | Triggered by <a>{{ dataBuild.data.build.user.attrs.accounts.github.username }}</a>
  h3(
    ng-if = "dataBuild.data.build.attrs.started"
  ) Message Log
  ol#messages(
    ng-if = "dataBuild.data.build.attrs.started && dataBuild.data.version.attrs.build.triggeredAction.appCodeVersion.repo"
  )
    li
      ol.message
        li
          a {{commit.message}}
        li
          a
            img(
              height = "20"
              src = "{{ commit.committer.gravatar }}?s=64"
              width = "20"
            )
            | #{''} {{commit.committer.username}}
          a {{commit.id}}
            svg.iconnables.icons-git
              use(xlink:href = "#icons-git")
  ol#messages(
    ng-if = "dataBuild.data.build.attrs.started && !dataBuild.data.version.attrs.build.triggeredAction.appCodeVersion.repo"
  )
    li
      ol.message.yolo
        li
          a {{ dataBuild.data.version.attrs.build.message }}
        li
          a
            img(
              height = "20"
              src = "{{ dataBuild.data.version.attrs.build.triggeredBy.gravatar }}?s=64"
              width = "20"
            )
            | #{''} {{ dataBuild.data.version.attrs.build.triggeredBy.username }}

//- code_editor
#editor(
  ng-class="{'in': dataBuild.data.showExplorer}"
)
  aside#explorer
    #controls
      button.toggle-theme.tooltip(
        data-title = "Change Theme"
        ng-class = "{dark: !dataBuild.data.toggleTheme, light: dataBuild.data.toggleTheme}"
        ng-click = "dataBuild.data.toggleTheme = !dataBuild.data.toggleTheme"
      )
        .theme
    //- h6(ng-if = "buildFiles.models.length")
    h6.explorer-header
      | CONFIG FILES
      a.btn.silver.btn-sm.file-explorer-menu.btn-icon(
        ng-class = "{active: dataBuild.data.showFileMenu}"
        toggle-pop-over
        toggle-pop-over-model = "dataBuild.data.showPopoverFileMenu"
      )
        svg.iconnables.icons-gear
          use(xlink:href = "#icons-gear")
        pop-over(
          template = "viewBuildPopoverFileMenu"
          actions = "{\
            createFile: actions.createFile\
          }"
          data = "{\
            showPopoverFileMenuAddRepo: data.showPopoverFileMenuAddRepo, \
            showPopoverFileMenuForm: data.showPopoverFileMenuForm, \
            show: dataBuild.data.showPopoverFileMenu \
          }"
        )
    file-tree(
      open-files = "dataBuild.data.openFiles"
      version = "dataBuild.data.version"
      build = "dataBuild.data.build"
    )
    h6.explorer-header
      | REPOSITORIES
      a.btn.silver.btn-sm.file-explorer-menu.btn-icon(
        ng-class = "{active: dataBuild.data.showRepoMenu}"
        toggle-pop-over
        toggle-pop-over-model = "dataBuild.data.showPopoverRepoMenu"
      )
        svg.iconnables.icons-gear
          use(xlink:href = "#icons-gear")
        pop-over(
          template = "viewBuildPopoverRepoMenu"
          actions = "{}"
          data = "{\
            show: dataBuild.data.showPopoverRepoMenu\
          }"
        )
    ul.repo-tree
      //- for "edit mode":
      //- * delete/editmode entered via context menu
      //- * add class .active to <li> (class should be applied while context menu is open)
      //- * remove readonly property from input and select all text
      //- * save on blur or enter key
      li(ng-repeat = "repoModel in dataBuild.data.version.attrs.appCodeVersions")
        span
          svg.iconnables.icons-git.filetypes
            use(xlink:href = "#icons-git")
          | {{ repoModel.attrs.repo }}
        input.tree-input(
          placeholder = "Specify Branch or SHA"
          readonly
          value = "{{ repoModel.attrs.commit }}"
        )

  button#explorer-toggle.btn-icon(
    ng-click = "dataBuild.actions.toggleExplorer()"
    type = "button"
  )
    svg.iconnables.icons-folder-open
      use(xlink:href = "#icons-folder-open")

  tabs(
    open-files = "dataBuild.data.openFiles"
  )
  tabs-dropdown(
    open-files = "dataBuild.data.openFiles"
  )
  active-panel(
    fork-build = "dataBuild.actions.forkBuild"
    open-files = "dataBuild.data.openFiles"
    is-clean = "dataBuild.data.build.attrs.started"
    is-dark-theme = "dataBuild.data.toggleTheme"
  )

//- logs
build-stream(
  ng-class = "{out: dataBuild.data.closed}"
)
