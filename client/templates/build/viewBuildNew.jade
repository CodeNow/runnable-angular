nav.sub-header
  h1.build-header.divided-header.in
    button.btn-icon.silver.tooltip(
      data-title = "View All Builds"
      ng-click = "dataBuildNew.actions.stateToBuildList()"
      type = "button"
    )
      svg.iconnables.icons-back-table
        use(xlink:href = "#icons-back-table")
    .iconnables.iconnables-container.build-status
      svg.iconnables.icons-asterisk
        use(xlink:href = "#icons-asterisk")
    | Build {{ dataBuildNew.data.build.attrs.buildNumber }}

  //- all buttons should be disabled during a build
  section#main-controls
    .btn-group
      button.green(
        type = "button"
        ng-click = "dataBuildNew.actions.build()"
      ) Build New
      a.btn.green.btn-icon(
        ng-class = "{active: dataBuildNew.data.buildPopoverBuildOptions.data.show}"
        toggle-pop-over
        toggle-pop-over-model = "dataBuildNew.data.buildPopoverBuildOptions.data.show"
      )
        svg.iconnables.icons-arrow-down
          use(xlink:href = "#icons-arrow-down")
        pop-over(
          actions = "dataBuildNew.data.buildPopoverBuildOptions.actions"
          data = "dataBuildNew.data.buildPopoverBuildOptions.data"
          template = "viewBuildPopoverBuildOptions"
        )
    button.silver(
      ng-click = "dataBuildNew.actions.discardChanges()"
      type = "button"
    ) Discard Changes

section.sidebar
  ul(ng-show = "dataBuildNew.data.build.attrs.created")
    li
      svg.iconnables.icons-recipe
        use(xlink:href = "#icons-recipe")
      b {{ dataApp.stateParams.branchName }}
      | #{''} config
    li(
      ng-show = "dataBuildNew.data.build.attrs.completed"
    )
      svg.iconnables.icons-duration
        use(xlink:href = "#icons-duration")
      | {{ dataBuildNew.data.build.succeeded() ? 'Built' : 'Failed' }} in {{ (dataBuildNew.data.build.buildTime() / 1000) | number:2 }} seconds
    li(
      interval-update
      interval-update-ms = "60000"
      ng-show = "dataBuildNew.data.build.attrs.started"
    )
      svg.iconnables.icons-calendar
        use(xlink:href = "#icons-calendar")
      | Initiated {{ dataBuildNew.data.build.attrs.started | timeAgo }}
    li
      svg.iconnables.icons-trigger
        use(xlink:href = "#icons-trigger")
      | Triggered by <a>{{ dataBuildNew.data.build.user.attrs.accounts.github.username }}</a>
  h3 Message Log
  ol#messages(
    ng-if = "dataBuildNew.data.build.attrs.started && dataBuildNew.data.version.attrs.build.triggeredAction.appCodeVersion.repo"
  )
    li(ng-repeat = "commit in dataBuildNew.data.version.attrs.build.triggeredAction.appCodeVersion.commitLog")
      ol.message
        li
          a {{commit.message}}
        li
          a
            img(
              height = "20"
              ng-src = "{{ commit.committer.gravatar }}?s=64"
              width = "20"
            )
            | #{''} {{commit.committer.username}}
          a {{commit.id}}
            svg.iconnables.icons-git
              use(xlink:href = "#icons-git")
  ol#messages(
    ng-if = "dataBuildNew.data.build.attrs.started && !dataBuildNew.data.version.attrs.build.triggeredAction.appCodeVersion.repo"
  )
    li
      ol.message
        li
          a {{ dataBuildNew.data.version.attrs.build.message }}
        li
          a
            img(
              height = "20"
              ng-src = "{{ dataBuildNew.data.version.attrs.build.triggeredBy.gravatar }}?s=64"
              width = "20"
            )
            | #{''} {{ dataBuildNew.data.version.attrs.build.triggeredBy.username }}

//- code_editor
#editor(
  ng-class="{'in': dataBuildNew.data.showExplorer}"
)
  aside#explorer
    #controls
      button.toggle-theme.tooltip(
        data-title = "Change Theme"
        ng-class = "{dark: !dataBuildNew.data.toggleTheme, light: dataBuildNew.data.toggleTheme}"
        ng-click = "dataBuildNew.data.toggleTheme = !dataBuildNew.data.toggleTheme"
      )
        .theme
    //- h6(ng-if = "buildFiles.models.length")
    h6.explorer-header
      | CONFIG FILES
      a.btn.silver.btn-sm.file-explorer-menu.btn-icon(
         ng-class = "{active: dataBuildNew.data.showFileMenu}"
         toggle-pop-over
         toggle-pop-over-model = "dataBuildNew.data.showPopoverFileMenu"
       )
         svg.iconnables.icons-gear
           use(xlink:href = "#icons-gear")
         pop-over(
           template = "viewBuildPopoverFileMenu"
           actions = "{\
             createFile: actions.createFile\
           }"
           data = "{\
             showPopoverFileMenuAddRepo: data.showPopoverFileMenuAddRepo, \
             showPopoverFileMenuForm: data.showPopoverFileMenuForm, \
             show: dataBuildNew.data.showPopoverFileMenu \
           }"
         )
    file-tree(
      open-files = "dataBuildNew.data.openFiles"
      version-or-context = "dataBuildNew.data.newVersion"
      build = "dataBuildNew.data.newBuild"
    )
    h6.explorer-header
      | REPOSITORIES
      a.btn.silver.btn-sm.file-explorer-menu.btn-icon(
         ng-class = "{ active: dataBuildNew.data.buildPopoverRepoMenu.data.show }"
         toggle-pop-over
         toggle-pop-over-model = "dataBuildNew.data.buildPopoverRepoMenu.data.show"
       )
         svg.iconnables.icons-gear
           use(xlink:href = "#icons-gear")
         pop-over(
           template = "viewBuildPopoverRepoMenu"
           actions = "dataBuildNew.data.buildPopoverRepoMenu.actions"
           data = "dataBuildNew.data.buildPopoverRepoMenu.data"
         )
    ul.repo-tree
      //- for "edit mode":
      //- * delete/editmode entered via context menu
      //- * add class .active to <li> (class should be applied while context menu is open)
      //- * remove readonly property from input and select all text
      //- * save on blur or enter key
      li(
        ng-repeat = "repoModel in dataBuildNew.data.newVersion.appCodeVersions.models"
        ng-class = "{active: dataBuildNew.data.dataFileTreePopoverRepoItemMenu.data.show}"
        popover-repo-item-menu
      )
        span
          svg.iconnables.icons-git.filetypes
            use(xlink:href = "#icons-git")
          | {{ repoModel.attrs.repo }}
        input.tree-input(
          placeholder = "Specify Branch or SHA"
          readonly
          value = "{{ repoModel.attrs.commit || repoModel.attrs.branch  }}"
        )

  button#explorer-toggle.btn-icon(
    ng-click = "dataBuildNew.data.showExplorer = !dataBuildNew.data.showExplorer"
    type = "button"
  )
    svg.iconnables.icons-folder-open
      use(xlink:href = "#icons-folder-open")

  tabs(
    open-files = "dataBuildNew.data.openFiles"
  )
  tabs-dropdown(
    open-files = "dataBuildNew.data.openFiles"
  )
  active-panel(
    update = "true"
    read-only = "false"
    open-files = "dataBuildNew.data.openFiles"
    is-dark-theme = "dataBuildNew.data.toggleTheme"
  )
